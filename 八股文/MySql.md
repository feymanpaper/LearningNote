### 解释一下乐观锁和悲观锁
https://xie.infoq.cn/article/2085a95ad6b486d3905adc7d6
**悲观锁阻塞事务、乐观锁回滚重试**
#### 悲观锁
**多线程同时修改共享资源的概率比较高，于是很容易出现冲突，所以访问共享资源前，先要上锁**。

自旋锁和互斥锁是悲观锁
互斥锁和自旋锁底层也是CAS实现的
#### 乐观锁
**先修改完共享资源，再验证这段时间内有没有发生冲突，如果没有其他线程在修改资源，那么操作完成，如果发现有其他线程已经修改过这个资源，就放弃本次操作**。

**ABA 问题：**如果一个变量 V 初次读取的时候是 A 值，并且在准备赋值的时候检查到它仍然是 A 值，那我们就能说明它的值没有被其他线程修改过了吗？很明显是不能的，因为在这段时间它的值可能被改为其他值，然后又改回 A，那 CAS 操作就会误认为它从来没有被修改过。这个问题被称为 CAS 操作的 "ABA"问题。

**ABA 问题解决：**我们需要加上一个版本号（Version）,在每次提交的时候将版本号+1 操作，那么下个线程去提交修改的时候，会带上版本号去判断，如果版本修改了，那么线程重试或者提示错误信息

乐观锁可以基于CAS和版本号实现
#### 为什么自旋是悲观锁？
自旋锁是
```
while CompareAndSwap(state, old, new)
```
乐观锁
```
do{
	//修改
}while CompareAndSwap(state, old, new)
```
#### mysql如何实现乐观锁和悲观锁
乐观锁: 在字段加上一个版本号
悲观锁: 
首先关闭 MySQL 数据库的自动提交属性。因为 MySQL 默认使用 autocommit 模式
悲观锁加锁 sql 语句： select num from t_goods where id = 2 for update
