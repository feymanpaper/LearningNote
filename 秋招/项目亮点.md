## 点赞
背景：互动场景，实时性强
实时性强，肯定是先写缓存，kafka异步插数据库；所以会出现点赞失败过了一段时间看没点赞上

### 点赞数
redis当盘，有个问题就是内存不够用
1.redis分片
2.可以用pika，360搞的一个可以在磁盘里兼容redis协议的

### 是否赞过
布隆过滤器
微博一年的数据放一个布隆过滤器，会有问题, 所以可以滚表的方式，一年12个月，按时间分片，每个月的视频都放在一个布隆过滤器里, 这个也跟推荐算法有关吧，比如推荐算法推荐的视频也是近期火的，老视频没啥流量
布隆过滤器(挡住没赞过的流量)-->缓存(是否真的赞过, 疑似已经赞过的)-->数据库
很小的内存挡住很大的流量
用户id和视频id作哈希

### 粉丝列表, 关注列表
两张表 
关注表 uid->like_uid, uid hash分表
粉丝表 like_uid->uid, like_uid hash分表

索引, 联合索引
当然也可以加上fans_id防止回表
主键可以用雪花id, 依赖时间
```sql
CREATE INDEX idx_user_time ON fans_table(user_id, time DESC);
```

```sql
SELECT user_id, fans_id, follow_time
FROM fans_table
WHERE user_id = '特定用户ID'  -- 替换为实际的用户ID
ORDER BY time DESC
LIMIT 100;
```

1.业务层面上保证, 不会翻到底, 最多给翻200条
2.前端传游标，避免深分页问题
zset，缓存，定长大小

双写方案，存库同时插缓存
先写缓存，然后异步插入数据库

### 其他业务
1.点赞的信息会给推荐业务，实时计算
2.点赞的信息会给产品，离线计算，分析